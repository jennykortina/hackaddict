---
layout: post
title:
date: '2007-06-20T00:10:00.000-04:00'
author: kortina
tags:
modified_time: '2007-06-20T00:11:53.591-04:00'
blogger_id: tag:blogger.com,1999:blog-5518298822864690168.post-7296559793602400572
---

<link rel="stylesheet" href="file:///Users/kortina/Documents/blog_posts/hackaddict/blogspot.css " type="text/css" media="screen" title="no title" charset="utf-8"><br />How to Make a Dynamic Context List for the Textmate GTDAlt Bundle<br /><br />In <b>Textmate > Preferences > Advanced > Shell Variables</b> add:<br /><b>TM_GTD_CONTEXTS_FILE = /Users/yourusername/Documents/GTD/contexts.txt</b><br /><br />The contents of this file should be something like:<br /><pre>sys email call home errands cafe ruby blog write</pre><br /><br />edit <br /><br />Now do:<br /><b>$ e /Users/yourusername/Library/Application\ Support/TextMate/Pristine\ Copy/Bundles/GTDAlt.tmbundle/Support/lib/GTDUtils.rb </b><br />replace the <b>get_env_contexts</b> method with this version:<pre><br />def get_env_contexts<br />  contexts_string = (ENV['TM_GTD_CONTEXTS_FILE']) ? `cat #{ENV['TM_GTD_CONTEXTS_FILE']}` : ""<br />  contexts = (contexts_string + "#{ENV['TM_GTD_CONTEXT']} #{ENV['TM_GTD_CONTEXTS']}").chomp.split(" ").compact.sort<br />  contexts = ["email", "office", "online", "home", "call", "waiting", "joe"] if contexts.empty?<br />  return contexts.uniq.sort<br />end<br /></pre><br /><br />Save the file.<br /><br />Now, modify the snippets to allow you to choose new contexts.<br />Open the Bundle editor (<b>^ ‚å• &#8984; B</b>)<br /><br />You'll need to edit these items in the GTDAlt Bundle:<br /><h4>New (c)</h4><br /><code><br /> #!/usr/bin/env ruby<br /> require ENV['TM_BUNDLE_SUPPORT'] + '/lib/GTDUtils.rb'<br /> require ENV['TM_SUPPORT_PATH'] + '/lib/ui.rb'<br /> contextList = GTDContexts.contexts<br /> <b>contextList.push "New Context"</b><br /> choice = TextMate::UI.menu(contextList)<br /><br /> <b>if choice && contextList[choice] == "New Context" then<br />   print "@${0:Type New Context Word and Hit Tab to Add}@"<br /> els</b>if choice then<br />   print "@#{contextList[choice]} "<br /> else<br /> require ENV['TM_SUPPORT_PATH'] + '/lib/exit_codes.rb'<br />   TextMate.exit_discard<br /> end<br /><br /></code><br /><h4>Change Context (c)</h4><br /><code><br /> #!/usr/bin/env ruby<br /> require ENV['TM_BUNDLE_SUPPORT'] + '/lib/GTDUtils.rb'<br /> require ENV['TM_SUPPORT_PATH'] + '/lib/ui.rb'<br /> line = STDIN.read<br /> contextList = GTDContexts.contexts<br /> <b>contextList.push "New Context"</b><br /> choice = TextMate::UI.menu(contextList)<br /><br /> <b>if choice && contextList[choice] == "New Context" then<br />   s = "@${0:Type New Context Word and Hit Tab to Add}@"<br />   print line.sub(/@(\S+)($|\s+)/) {|text,space| s + ((space.nil? or space == "") ? " " : space)}<br /> els</b>if choice then<br />   print line.sub(/@(\S+)($|\s+)/) {|text,space| "@" + e_sn(contextList[choice]) + ((space.nil? or space == "") ? " " : space)+"$0"}<br /> else<br />   print e_sn(line)<br /> end<br /></code><br /><br />Add a command to the bundle to delete a context from the contexts txt file:<br /><h4>Delete Context (c)</h4><br /><code><br /> #!/usr/bin/env ruby<br /> require ENV['TM_BUNDLE_SUPPORT'] + '/lib/GTDUtils.rb'<br /> require ENV['TM_SUPPORT_PATH'] + '/lib/ui.rb'<br /> contextList = GTDContexts.contexts.collect {|c| "Delete #{c} context" }<br /><br /> choice = TextMate::UI.menu(contextList)<br /><br /> if choice && contextList[choice].to_s =~ /Delete\s(\w+)\scontext/i then<br />   _delete = $1<br />   # this should prolly be moved into GTDUtil.rb<br />   if ENV['TM_GTD_CONTEXTS_FILE']<br />  contexts = (`cat #{ENV['TM_GTD_CONTEXTS_FILE']}`).split(%r{\s+})<br />      contexts.delete(_delete)<br />      f = File.open(ENV['TM_GTD_CONTEXTS_FILE'], "w")<br />      f.write contexts.uniq.join(" ")<br />      f.close<br />  print "Deleted #{_delete} context"<br />   else<br />  print "Nothing deleted."<br />   end<br /><br /> else<br />   print "Nothing deleted."<br /> end<br /></code><br /><br /><br />Make Your Inbox<br />cmd alt option L - edit GTDAlt - add filetype: gtdinbox<br />touch ~/Documents/GTD/inbox.gtdinbox<br /><br />^ spacebar => launch quicksilver<br />Textmate | tab | Open File | tab | ~/Documents/GTD/inbox.gtdinbox<br />Click the arrow down arrow, then do <b>Triggers</b><br />Click the <b>+</b> to add a new trigger<br />Set a hotkey for your trigger ( I used ^ alt spacebar )<br /><br />In the GTDAlt Language Grammar, add the following code to the repository section:<br /><code><br /> repository = {<br />  ----- BEGIN new stuff ------<br />  <b>projectname = {<br />   match = '\s+(>\w+)\b';<br />   captures = { <br />       1 = { name = 'support.function.projectname.gtdalt'; };<br />   };<br />  };</b><br />  ------ END new stuff -----<br />  date = {<br /></code><br />Edit the <b>title</b> entry in the language grammar to look like this:<br /><code><br /> title = {<br />  name = 'constant.other.title.gtdalt';<br />  match = '\S+(?:\s+\S+)*?(?=\s*(?:\[\d+\]|(?:due|at|from):|$|(?:\s+>)))';<br /> };<br /></code><br />In meta.action.gtdalt, add another include line:<br /><code><br /> { name = 'meta.action.gtdalt';<br />  begin = '^\s*((@)\S++\s)';<br />  end = '\n|$';<br />  beginCaptures = {<br />   1 = { name = 'storage.type.context.action.gtdalt'; };<br />   2 = { name = 'punctuation.definition.context.action.gtdalt'; };<br />  };<br />  patterns = (<br />   { include = '#note'; },<br />   { include = '#date'; },<br />   { include = '#title'; },<br />   <b>{ include = '#projectname'; },</b><br />  );<br /></code>